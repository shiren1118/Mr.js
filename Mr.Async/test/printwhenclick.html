<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../Mr.async.js"></script>
		<script type="text/javascript" src="parser.js"></script>
		<script type="text/javascript" src="ExpressionVisitor.js"></script>
		<script type="text/javascript" src="Mr.array.js"></script>
		<script type="text/javascript">
			var code = UglifyJS.parse('for(var i = 0 ; i < 10 ; i++){if(i == 5) continue;console.log(i + 1);}');

			window.onload = function(){

				var __recodeLoop = function(condition, block, innerBefore, outerBefore, after){
					if(condition == null || block == null) 
						throw 'condition or block is null';
					
					if(outerBefore != null){
						this.visit(outerBefore);
					}

					this.codes.push('Mr.asynIterator(Mr.infinite(), function(cnt){');

					if(after != null){
						this.codes.push('if(cnt != 1){');
						this.visit(after);
						this.codes.push(';');
						this.codes.push('}');
					}

					if(innerBefore != null){
						this.codes.push('if(cnt == 1){');
						this.visit(innerBefore);
						this.codes.push('}');
					}

					this.codes.push('if(');
					var conditional = this.visit(condition);
					this.codes.push('){');
					var block = this.visit(block);
					
					this.codes.push('this.next();');
					this.codes.push('}else{');
					this.codes.push('return Mr.BREAK;');
					this.codes.push('}');
					this.codes.push('});');
				};

				window.EV = Mr.EV.extend({
					visitForLoop : function(expression, base){
						__recodeLoop.call(this, expression[2], expression[4], null, expression[1], expression[3]);
						return expression;
					},
					visitDoWhileLoop : function(expression, base){
						__recodeLoop.call(this, expression[1], expression[2], expression[2]);
						return expression;
					},
					visitWhileLoop : function(expression, base){
						__recodeLoop.call(this, expression[1], expression[2]);
						return expression;
					},
					visitStatement : function(expression, base){
						var key = expression[0];
						switch(key){
							case 'break':
								this.codes.push('return Mr.BREAK;');
								return expression;
							case 'continue':
								this.codes.push('return Mr.CONTINUE;');
								return expression;
						}
						return base(expression);
					}
				});
			};
		</script>
	</head>
	<body style="height:1000px;">
		<ul id="output">
			
		</ul>
	</body>
</html>

<!--
function while1(){
	var i = 0;
	Mr.asynIterator(Mr.infinite(), function(){
		if(i++ < 10){
			if(i == 5) return Mr.CONTINUE;
			console.log(i + 1);
			this.next();
		}else{
			return Mr.BREAK;
		}
	});

	i = 0;while(i++ < 10){if(i == 5)continue;console.log(i + 1);}
}
while1();

function for1(){
	for(var i = 0 ; i < 10 ; i++){if(i == 5) continue;console.log(i + 1);}
	
	var i = 0;
	Mr.asynIterator(Mr.infinite(), function(){
		if(i < 10){
			if(i == 5)
			{
				i++;
				return Mr.CONTINUE;
			}

			console.log(i + 1);
			i++;
			this.next();
		}else{
			return Mr.BREAK;
		}
	});
}

function doWhile(){
	var i = 0;do{if(i == 5) continue;console.log(i + 1);}while(i++ < 10);

	i = 0;
	Mr.asynIterator(Mr.infinite(), function(){
		if(i == 5){
			i++;
			return Mr.CONTINUE;
		}
		console.log(i + 1);
		if(i++ < 10){
			this.next();
		}else{
			return Mr.BREAK;
		}
	});
}-->